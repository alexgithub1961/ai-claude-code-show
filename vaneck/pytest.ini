[tool:pytest]
# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output and formatting
addopts = 
    -v
    --tb=short
    --strict-markers
    --strict-config
    --color=yes
    --durations=10
    --showlocals

# Async support
asyncio_mode = auto

# Coverage settings
addopts = 
    --cov=src
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-branch
    --cov-context=test

# Markers for test categorisation
markers =
    unit: Unit tests - fast, isolated tests
    integration: Integration tests - test component interactions
    e2e: End-to-end tests - full system tests
    slow: Slow running tests (> 5 seconds)
    network: Tests requiring network access
    selenium: Tests using Selenium WebDriver
    docker: Tests requiring Docker
    performance: Performance and load tests

# Test filtering
minversion = 7.0
required_plugins = 
    pytest-asyncio>=0.21.0
    pytest-mock>=3.10.0
    pytest-cov>=4.0.0

# Logging configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s (%(filename)s:%(lineno)d)
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s (%(filename)s:%(lineno)d)
log_file_date_format = %Y-%m-%d %H:%M:%S

# Warnings configuration
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning:selenium.*
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning

# Test discovery patterns
norecursedirs = 
    .git
    .tox
    dist
    build
    *.egg
    .venv
    venv
    __pycache__
    .pytest_cache
    htmlcov

# xfail configuration
xfail_strict = true

# Timeout settings (if pytest-timeout is installed)
timeout = 300
timeout_method = thread

# Parallel execution settings (if pytest-xdist is installed)
# These are defaults, can be overridden via command line
dist = loadfile
tx = popen//python=python3

# Custom test collection
collect_ignore = [
    "setup.py",
    "docs",
    "build", 
    "dist"
]

# JUnit XML configuration
junit_suite_name = vaneck_etf_downloader
junit_logging = all
junit_log_passing_tests = false
junit_duration_report = total
junit_family = xunit2

# Mock configuration
mock_use_standalone_module = true

# Temporary directory configuration  
tmp_path_retention_count = 3
tmp_path_retention_policy = failed